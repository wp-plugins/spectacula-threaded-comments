jQuery(document).ready(function(d){function f(){var h;if(window.getSelection){h=window.getSelection()}else{if(document.getSelection){h=document.getSelection()}else{if(document.selection){h=document.selection.createRange().text}}}return h.toString()!=""?h.toString():false}function b(h){return h.id!=null&&(h.id==="quote-float"||b(h.parentNode))}function c(h){d(h).find(".comment-buttons").append(d('<a href="#" class="comment-button">'+specQuoteLn.button_text+"</a>").click(function(){g(this);return false}))}function g(j){var k=d(j).parents(".comment-buttons").prev(".comment-text").html(),i=d(j).parents(".comment-buttons").siblings(".comment-meta").find("cite.fn").text(),h="";h="<blockquote>\n<cite>"+d.trim(i)+"</cite>\n"+d.trim(k)+"\n</blockquote>\n";a("comment",h)}function e(k){k.focus();var i=document.selection.createRange(),h=k.createTextRange(),j=h.duplicate();h.moveToBookmark(i.getBookmark());j.setEndPoint("EndToStart",h);return i==null?0:j.text.length}function a(l,h){var k=document.getElementById(l),i=k.value,j=k.selectionStart!==undefined?k.selectionStart:e(k);d("#"+l).val(i.substring(0,j)+h+i.substring(j,i.length)).trigger("keyup").focus();d.scrollTo("#"+l,{duration:500,axis:"y"})}if(specQuoteLn.quote_button){d(".comment").each(function(){c(this)}).live("newComment",function(){c(this)})}if(specQuoteLn.quote_select){d(specQuoteLn.quote_target).mouseup(function(k){var i=f(),j=d(k.currentTarget),l=k.pageY,h=j.offset().left+j.width();if(i){d("<div><span>"+specQuoteLn.button_text+"</span></div>").attr({id:"quote-float"}).appendTo("body").css({position:"absolute",left:h+10,top:l-(d("#quote-float").height()/2),zIndex:1000}).click(function(){a("comment","<blockquote>\n"+d.trim(i)+"\n</blockquote>\n");d("#quote-float").remove()})}});d(document).mousedown(function(i){var h=i.target||window.event.srcElement;if(!b(h)){d("#quote-float").remove()}})}});